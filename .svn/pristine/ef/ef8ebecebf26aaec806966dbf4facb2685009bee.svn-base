define(["import/bootbox.min","datatables","datatables.bootstrap"],function (bootbox) {

	var alert = function(message,width){
			var dialog = bootbox.dialog({
	        message: message,
	        title: "<i class='fa fa-exclamation-triangle orange'></i> 提示信息",
	        buttons:
	        {
	            "success" :
	            {
	                "label" : "<i class='fa fa-check'></i> 确定",
	                "className" : "btn-warning"
	            }
	        }
	    }).css("z-index",9999999999999);
	    if(width){
	        $(".modal-dialog").width(width);
	    }
	};
	var confirm = function (message,callback,width){
	    bootbox.dialog({
	        message: message,
	        title: "<i class='fa fa-question-circle orange'></i> 确认信息",
	        buttons:
	        {
	            "success" :
	            {
	                "label" : "<i class='fa fa-check'></i> 确定",
	                "className" : "btn-danger",
	                "callback":function(){
	                    callback();
	                }
	            },
	            "reject" :
	            {
	                "label" : "<i class='fa fa-times'></i> 取消",
	                "className" : "btn-info"
	            }
	        }
	    }).css("z-index",9999999999999);

	    if(width){
	        $(".modal-dialog").width(width);
	    }
	};
	var prompt = function(title,callback){
	    var promptOptions = {
	        title: title,
	        buttons: {
	            confirm: {
	                label: "<i class='fa fa-check'></i> 确认",
	                "className" : "btn-danger"

	            },
	            cancel:{
	                label: "<i class='fa fa-times'></i>取消",
	                "className" : "btn-info"
	            }
	        },
	        inputType:"textarea",
	        callback: function(result){
	            callback(result);
	        }
	    };
	    bootbox.prompt(promptOptions);
	};
	//message
	var message = function(msg,type){
		 var messageAlert = $('<div class="alert alert-'+type+' text-center"><button type="button" class="close" data-dismiss="alert"><i class="fa fa-times"></i></button>'+msg+'<br /></div>');
	    $("body").prepend(messageAlert);
	    setTimeout(function(){
	        messageAlert.hide(1000,"swing");
	    },1500);
	}
	//表格checkbox
    var getTableCheckbox = function(id,name){
        return '<label><input class="ace" type="checkbox" name="'+name+'" value="'+id+'" /><span class="lbl"></span></label>';

    };
    //获取checkbox值
    var getTableCheckedbox = function(pos){
	    var values = [];
	    var $input = $(pos).find("input[type='checkbox']");
	    $.each($input,function(index,input){
	        if(input.checked == true){
	            values.push(input.value);
	        }
	    });
	    return values;
	};
    //表格radio
    var getTableRadio = function(id,name){
        return '<label><input class="ace" type="radio" name="'+name+'" value="'+id+'" /><span class="lbl"></span></label>';
    };
    //获取表格radio 值
    var getTableRadioVal = function(pos){
    	return $(pos).find("input[type='radio'].ace:checked").val();
    };
    //填充表单
    var renderForm = function(pos,obj){
    	var key,value,tagName,type,arr;
	    for(x in obj){
	        key = x;
	        value = obj[x];
	         
	        $(pos).find("[name='"+key+"'],[name='"+key+"[]']").each(function(){
	            tagName = $(this)[0].tagName;
	            type = $(this).attr('type');
	            if(tagName=='INPUT'){
	                if(type=='radio'){
	                    $(this).attr('checked',$(this).val()==value);
	                }else if(type=='checkbox'){
	                    arr = value.split(',');
	                    for(var i =0;i<arr.length;i++){
	                        if($(this).val()==arr[i]){
	                            $(this).attr('checked',true);
	                            break;
	                        }
	                    }
	                }else{
	                    $(this).val(value);
	                }
	            }else if(tagName=='SELECT' || tagName=='TEXTAREA'){
	                $(this).val(value);
	            }
	             
	        });
	    }
    }
    //jquery DataTable
    var renderDataTable = function(pos,config){
        var defaultConfig = {
            "ordering":false,//是否排序
            "bProcessing": true,//是否显示正在处理信息
            "bServerSide": true,//是否启动服务器端数据导入，即要和sAjaxSource结合使用
            "bDestroy":true,//用于当要在同一个元素上执行新的dataTable绑定时，将之前的那个数据对象清除掉，换以新的对象设置
            'bPaginate': true,//是否分页
            "bFilter": false,
            "oLanguage": {
                "sProcessing": "正在加载中......",
                "sInfoEmpty": "没有记录...",
                "sEmptyTable": "查询记录为空...",
                "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录"
             },
             //"sAjaxSource":config.sAjaxSource,//后台访问地址
             //"fnServerParams"://发送额外的数据
             "fnServerData":function(sSource, aoData, fnCallback ){
                $.ajax( {
                    "type": "GET",
                    "contentType": "application/json",
                    "url": sSource,
                    "dataType": "json",
                    "data": aoData, //以json格式传递
                    "success": function(resp) {
                        if(resp.error!=undefined){
                            component.alert(resp.error);
                            return;
                        }
                        if(resp=="NoPermission"){
                            var object={};
                            object.aaData=[{"permission":"NoPermission"}];
                            resp=object;
                        }
                        fnCallback(resp.doc); //服务器端返回的对象的returnObject部分是要求的格式
                    }
                });
             },//用于替换默认发到服务端的请求操作
             //"aoColumns":config.columns//定义列
             //"fnPreDrawCallback"://用于在开始绘制之前调用，返回false的话，会阻止draw事件发生；返回其它值，draw可以顺利执行
        }
        //自定义
        for(var key in config){
            defaultConfig[key] = config[key];
        }

        $(pos).dataTable(defaultConfig);
    };

    var toJsonObject = function($obj){
        var serializeObj={};
        var array=$obj.serializeArray();
        $(array).each(function(){
            if(this.value){
                if(serializeObj[this.name]){
                    if($.isArray(serializeObj[this.name])){
                        serializeObj[this.name].push(this.value);
                    }else{
                        serializeObj[this.name]=[serializeObj[this.name],this.value];
                    }
                }else{
                    serializeObj[this.name]=this.value;
                }
            }
        });
        return serializeObj;
    }
    //菜单迭代处理
    var menuIterator = function(config,menus){
    	for(var i=0,len=config.length;i<len;i++){
    		var obj = {
    			"name":config[i].name,
    			"hash":config[i].hash,
    			"pic":config[i].pic,
    			"desc":config[i].desc,
    			"code":config[i].code,
    			"pCode":config[i].pCode
    		};
    		var flag = config[i].children&&config[i].children.length>0;
    		if(flag){
    			obj.isParent = "true";
    		}else{
    			obj.isParent = "false";
    		}
	        menus.push(obj);
	        if(flag){
	            menuIterator(config[i].children,menus);
	        }
	    }
	    return menus;

    }

     //获取菜单信息
     //flag:是否需要平铺数组类型返回 true为不需要
     //app 表示获取的应用的菜单 null为全部获取
    var getMenus = function(app,flag,callback){
        $.getJSON("/config/menu.json", function(config){
        	var menus = [];
            for(var i=0,len=config.length;i<len;i++){
            	if(!app){//全部获取
            		if(flag){
            			return callback(config[i]);
            		}else{
            			menus = menuIterator([config[i]],menus);
            		}
            	}else if(config[i].app == app){//获取对应的一个
            		if(flag){
            			return callback(config[i]);
            		}else{
            			menus = menuIterator([config[i]],[]);
            			break;
            		}
            		
            	}
            }
            return callback(menus);
        })
    }

    return {
        alert:alert,
        confirm:confirm,
        prompt:prompt,
        message:message,
        getTableCheckbox:getTableCheckbox,
        getTableCheckedbox:getTableCheckedbox,
        getTableRadio:getTableRadio,
        getTableRadioVal:getTableRadioVal,
        renderForm:renderForm,
        renderDataTable:renderDataTable,
        toJsonObject:toJsonObject,
        getMenus:getMenus
    }
});